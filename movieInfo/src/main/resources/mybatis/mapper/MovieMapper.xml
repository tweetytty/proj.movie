<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.sm.movieinfo.content.dao.MovieDAO">
 
    <resultMap type="MovieVO" id="movieResult">
        <id property="movieId" column="movie_id"/>
        <result property="title" column="title"/>
        <result property="openDate" column="openDate"/>
        <result property="age" column="age"/>
        <result property="duration" column="duration"/>
        <result property="genre" column="genre"/>
        <result property="director" column="director"/>
        <result property="actor" column="actor"/>
        <result property="nation" column="nation"/>
        <result property="grades" column="grades"/>
        <result property="story" column="story"/>
        <result property="img" column="img"/>
        <result property="ctime" column="ctime"/>
    </resultMap>
 
    <select id="getAllMovie" resultMap="movieResult">
        SELECT
            movie_id, title, openDate, age, duration,
            genre, director, actor, nation, grades, story, img, ctime
        FROM
            tb_movie
         ORDER BY movie_id desc
    </select>
 
    <select id="getMovie" parameterType="MovieVO" resultMap="movieResult">
        SELECT
            movie_id, title, openDate, age, duration,
            genre, director, actor, nation, grades, story, img, ctime
        FROM
            tb_movie
        WHERE
        	1=1
            <if test="movieId != -1"> AND movie_id=#{movieId}</if>
            <if test="title != null"> AND title=#{title}</if>
    </select>
    
    <insert id="insertMovie" parameterType="MovieVO" useGeneratedKeys="true" keyProperty="movieId">
        INSERT INTO tb_movie
            (title, openDate, age, duration, genre, 
            director, actor, nation, grades, story, img, ctime)
        VALUES
            (#{title}, #{openDate}, #{age}, #{duration}, #{genre}, 
            #{director}, #{actor}, #{nation}, #{grades}, #{story}, #{img}, strftime('%s', 'NOW'))
    </insert>
 
    <delete id="deleteMovieAll">
        DELETE FROM
            tb_movie
    </delete>
    
    <delete id="deleteMovie" parameterType="MovieVO">
        DELETE FROM
            tb_movie
        WHERE
            movie_id=#{movieId}
    </delete>
 
</mapper>